{% extends 'core/page.html' %}
{% load staticfiles %}
{% load compress %}
{% load i18n %}
{% load core_tags %}


{% block head %}
{% compress css %}
<link rel="stylesheet" type="text/x-scss" href="{% static 'projects/css/project_questions_form.scss' %}" />
{% endcompress %}

<script type="text/javascript" src="{% static 'angular/angular.min.js' %}" ></script>
<script type="text/javascript" src="{% static 'projects/js/project_questions_form.js' %}" ></script>
{% endblock %}


{% block page %}

    <h2>{% blocktrans %}Questionaire for project <em>{{ project }}</em>{% endblocktrans %}</h2>

    <div class="project-questions-form"
         ng-app="project_questions_form" ng-controller="FormController"
         ng-init='service.init({{ options_json|safe }})'>

        <div class="project-questions-form-buttons pull-right">
            <button type="button" class="btn btn-default" ng-disabled="!service.options.has_prev"
                    ng-click="service.redirect('{% url 'project_questions_prev' project.pk question_entity.pk %}')">
                {% trans 'Previous' %}
            </button>
            <button type="button" class="btn btn-default" ng-disabled="!service.options.has_next"
                    ng-click="service.redirect('{% url 'project_questions_next' project.pk question_entity.pk %}')">
                {% trans 'Next' %}
            </button>
        </div>

        <h3 class="project-questions-form-title">
            {{ question_entity.title }}
        </h3>

        <form ng-submit="service.saveAndNext()">

        {% if questionset %}

            {% if questionset.attributeset.is_collection %}

            <div class="questionset-head">
                <div class="pull-right">
                    <button type="button" class="btn btn-success" ng-click="service.addValueSet()">
                        {% trans 'Add new set' %}
                    </button>
                    <button type="button" class="btn btn-danger" ng-click="service.removeValueSet()">
                        {% trans 'Remove set' %}
                    </button>
                </div>

                <ul class="pagination">
                    <li ng-class="{ active: valueset == service.valueset }"
                        ng-repeat="valueset in service.valuesets"
                        ng-hide="valueset.removed">
                        <a href="" ng-click="service.valueset = valueset">#{$ $index + 1 $}</a>
                    </li>
                </ul>
            </div>

            {% endif %}

            {% for question in questionset.questions.all %}

            <div>
                <div class="form-group field-{{ question.attribute.tag }}">
                    <div class="form-label">{{ question.text }}</div>

                    {% if question.widget_type == 'text' %}
                        {% include 'projects/project_questions_form_text.html' with attribute=question.attribute is_set=True %}
                    {% elif question.widget_type == 'textarea' %}
                        {% include 'projects/project_questions_form_textarea.html' with attribute=question.attribute is_set=True %}
                    {% elif question.widget_type == 'yesno' %}
                        {% include 'projects/project_questions_form_yesno.html' with attribute=question.attribute is_set=True %}
                    {% elif question.widget_type == 'radio' %}
                        {% include 'projects/project_questions_form_radio.html' with attribute=question.attribute is_set=True %}
                    {% elif question.widget_type == 'checkbox' %}
                        {% include 'projects/project_questions_form_checkbox.html' with attribute=question.attribute is_set=True %}
                    {% endif %}

                    {% if question.attribute.is_collection %}

                    <div class="form-group">
                        <button type="button" class="btn btn-success"
                                ng-click="service.addValueSetValue({{ question.attribute.id }})">
                            {% trans 'Add new item' %}
                        </button>
                    </div>

                    {% endif %}

                </div>
            </div>

            {% endfor %}

        {% else %}

            <div class="form-group field-{{ question.attribute.tag }}">
                <div class="form-label">{{ question.text }}</div>

                {% if question.widget_type == 'text' %}
                    {% include 'projects/project_questions_form_text.html' with attribute=question.attribute %}
                {% elif question.widget_type == 'textarea' %}
                    {% include 'projects/project_questions_form_textarea.html' with attribute=question.attribute %}
                {% elif question.widget_type == 'yesno' %}
                    {% include 'projects/project_questions_form_yesno.html' with attribute=question.attribute %}
                {% elif question.widget_type == 'radio' %}
                    {% include 'projects/project_questions_form_radio.html' with attribute=question.attribute %}
                {% elif question.widget_type == 'checkbox' %}
                    {% include 'projects/project_questions_form_checkbox.html' with attribute=question.attribute is_set=True %}
                {% endif %}

            </div>

            {% if question.attribute.is_collection %}

            <div class="form-group">
                <button type="button" class="btn btn-success" ng-click="service.addValue()">
                    {% trans 'Add new item' %}
                </button>
            </div>

            {% endif %}

        {% endif %}

            <div class="help-block error" ng-show="service.errors"></div>



            <div class="form-group">
                <button type="button" class="btn btn-default" ng-click="service.save()">
                    {% trans 'Save' %}
                </button>
<!--
                <button type="button" class="btn btn-primary" ng-show="service.options.has_next"
                        ng-click="service.saveAndRedirect('{% url 'project_questions_next' project.pk question_entity.pk %}')">
                    {% trans 'Save and continue' %}
                </button>
                <button type="button" class="btn btn-primary" ng-hide="service.options.has_next"
                        ng-click="service.saveAndRedirect('{% url 'project' project.pk %}')">
                    {% trans 'Save and return to overview' %}
                </button>
-->
            </div>

        </form>
    </div>

{% endblock %}

{% block sidebar %}

    <h3>{% trans 'Progress' %}</h3>

    <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
             style="min-width: 2em; width: {{ progress }}%;">
            <span>{{ progress }}%</span>
        </div>
    </div>

    <h3>{% trans 'Options' %}</h3>

    <ul class="list-unstyled">
        <li>{% internal_link _('Back to project') 'project' project.id %}</li>
    </ul>

{% endblock %}
